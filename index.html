<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arrakis Tycoon - Dune MMO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #1c1917; }
        h1, h2, h3, h4, .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .tab-button { transition: all 0.2s ease-in-out; }
        .tab-button.active { border-bottom-color: #f59e0b; color: #f59e0b; }
        .progress-bar-bg { background-color: #57534e; }
        .progress-bar-fill { background-color: #f59e0b; transition: width 0.3s ease; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #44403c; border-radius: 4px;}
        ::-webkit-scrollbar-thumb { background: #a8a29e; border-radius: 4px;}
        ::-webkit-scrollbar-thumb:hover { background: #d6d3d1; }
        .map-grid { display: grid; gap: 1px; background-color: #292524; border: 1px solid #44403c; }
        .map-cell { 
            position: relative;
            transition: all 0.1s;
            border: 1px solid transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        .map-cell:hover {
            transform: scale(1.1);
            z-index: 10;
            border-color: #ffffff;
        }
        .minimap-container {
            position: relative;
            width: 150px;
            height: 150px;
            background: #1c1917;
            border: 1px solid #44403c;
            overflow: hidden;
        }
        .minimap-cell {
            position: absolute;
            width: 3px;
            height: 3px;
        }
        .player-indicator { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            transform: translateX(400px);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show { transform: translateX(0); }
        .notification.success { background-color: #059669; }
        .notification.error { background-color: #dc2626; }
        .notification.warning { background-color: #d97706; }
        .notification.info { background-color: #2563eb; }
        .inventory-slot {
            width: 50px;
            height: 50px;
            border: 2px solid #44403c;
            background: #292524;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
        }
        .inventory-slot:hover {
            border-color: #f59e0b;
            transform: scale(1.05);
        }
        .inventory-slot.filled {
            border-color: #6b7280;
        }
        .item-rarity-common { border-color: #6b7280 !important; }
        .item-rarity-uncommon { border-color: #059669 !important; }
        .item-rarity-rare { border-color: #2563eb !important; }
        .item-rarity-epic { border-color: #7c3aed !important; }
        .item-rarity-legendary { border-color: #f59e0b !important; }
    </style>
</head>
<body class="bg-stone-900 text-amber-50 antialiased">

    <!-- Header -->
    <header class="bg-stone-800 border-b border-stone-700 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h1 class="text-3xl font-orbitron font-bold text-amber-400">Arrakis Tycoon</h1>
                <span class="text-sm text-amber-200 italic">The spice must flow...</span>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-sm">
                    <span class="text-stone-400">Players Online:</span>
                    <span id="playersOnline" class="text-amber-400 font-semibold">1</span>
                </div>
                <div class="text-sm">
                    <span class="text-stone-400">Rank:</span>
                    <span id="playerRank" class="px-2 py-1 bg-stone-700 rounded text-xs font-semibold">Novice</span>
                </div>
                <button id="saveBtn" class="px-3 py-1 bg-green-700 hover:bg-green-600 rounded text-sm">üíæ Save</button>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs (Simplified) -->
    <nav class="bg-stone-800 border-b border-stone-700 px-6">
        <div class="flex space-x-1">
            <button class="tab-button active px-4 py-3 text-sm font-medium border-b-2 border-transparent hover:text-amber-400" data-tab="game">Game</button>
            <button class="tab-button px-4 py-3 text-sm font-medium border-b-2 border-transparent hover:text-amber-400" data-tab="character">Character & Inventory</button>
            <button class="tab-button px-4 py-3 text-sm font-medium border-b-2 border-transparent hover:text-amber-400" data-tab="multiplayer">Multiplayer</button>
            <button class="tab-button px-4 py-3 text-sm font-medium border-b-2 border-transparent hover:text-amber-400" data-tab="lore">Lore</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex h-[calc(100vh-120px)]">
        <!-- Left Sidebar -->
        <aside class="w-80 bg-stone-800 border-r border-stone-700 flex flex-col">
            <!-- Resources Panel -->
            <div class="p-4 border-b border-stone-700">
                <h3 class="text-lg font-semibold text-amber-400 mb-3">üì¶ Resources</h3>
                <div class="space-y-2">
                    <div class="flex items-center justify-between">
                        <span class="flex items-center text-sm">‚ú® Spice:</span>
                        <span id="spiceCount" class="font-mono text-amber-300">0</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="flex items-center text-sm">üíß Water:</span>
                        <span id="waterCount" class="font-mono text-blue-300">842</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="flex items-center text-sm">üí∞ Solari:</span>
                        <span id="solariCount" class="font-mono text-yellow-300">224</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="flex items-center text-sm">üîß Plasteel:</span>
                        <span id="plasteelCount" class="font-mono text-gray-300">146</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="flex items-center text-sm">üçñ Food:</span>
                        <span id="foodCount" class="font-mono text-green-300">20</span>
                    </div>
                    <div class="mt-3">
                        <span class="flex items-center text-sm">‚ù§Ô∏è Health:</span>
                        <div class="mt-1 progress-bar-bg rounded-full h-2">
                            <div id="healthBar" class="progress-bar-fill h-full rounded-full" style="width: 100%"></div>
                        </div>
                        <span id="healthText" class="text-xs text-stone-400">200 / 200</span>
                    </div>
                </div>
            </div>

            <!-- Manual Actions -->
            <div class="p-4 border-b border-stone-700">
                <h3 class="text-lg font-semibold text-amber-400 mb-3">üî® Manual Actions</h3>
                <div class="space-y-2">
                    <button id="harvestSpiceBtn" class="w-full px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm font-medium transition-colors">
                        ‚ú® Harvest Spice
                    </button>
                    <p class="text-xs text-stone-400">Click to gather spice manually</p>
                    <div class="text-xs text-stone-400 mt-2">
                        Harvest Level: <span id="harvestLevel" class="text-amber-400">1</span> 
                        (+<span id="harvestAmount" class="text-amber-400">1</span> per click)
                    </div>
                </div>
            </div>

            <!-- Minimap -->
            <div class="p-4 border-b border-stone-700">
                <h3 class="text-lg font-semibold text-amber-400 mb-3">üó∫Ô∏è Minimap</h3>
                <div id="minimapContainer" class="minimap-container mx-auto"></div>
                <div class="mt-2 text-xs text-stone-400 text-center">
                    Position: <span id="playerPosition" class="font-mono text-amber-300">(25, 25)</span>
                </div>
            </div>

            <!-- Event Log -->
            <div class="flex-1 flex flex-col p-4">
                <h3 class="text-lg font-semibold text-amber-400 mb-3">üìú Event Log</h3>
                <div id="gameLog" class="flex-1 bg-stone-900 rounded p-2 text-xs overflow-y-auto"></div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col">
            <!-- Game Tab -->
            <div id="gameTab" class="tab-content flex-1 flex">
                <div class="flex-1 flex flex-col">
                    <!-- Left Section - Map & Buildings -->
                    <div class="flex-1 grid grid-cols-2 gap-4 p-4">
                        <!-- Map -->
                        <div class="bg-stone-800 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-lg font-semibold text-amber-400">üèúÔ∏è Desert Map</h3>
                                <div class="flex items-center space-x-2">
                                    <button class="move-btn px-2 py-1 bg-stone-700 hover:bg-stone-600 rounded text-xs" data-dir="north">‚¨ÜÔ∏è</button>
                                    <button class="move-btn px-2 py-1 bg-stone-700 hover:bg-stone-600 rounded text-xs" data-dir="west">‚¨ÖÔ∏è</button>
                                    <button class="move-btn px-2 py-1 bg-stone-700 hover:bg-stone-600 rounded text-xs" data-dir="east">‚û°Ô∏è</button>
                                    <button class="move-btn px-2 py-1 bg-stone-700 hover:bg-stone-600 rounded text-xs" data-dir="south">‚¨áÔ∏è</button>
                                </div>
                            </div>
                            <div id="mapContainer" class="map-grid" style="grid-template-columns: repeat(15, 30px); grid-template-rows: repeat(15, 30px);"></div>
                        </div>

                        <!-- Buildings & Upgrades -->
                        <div class="bg-stone-800 rounded-lg p-4 overflow-y-auto">
                            <h3 class="text-lg font-semibold text-amber-400 mb-3">üèóÔ∏è Buildings & Upgrades</h3>
                            
                            <!-- Manual Upgrades -->
                            <div class="mb-4">
                                <h4 class="font-semibold mb-2">Manual Production</h4>
                                <div class="bg-stone-700 rounded p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm">‚ú® Spice Harvesting</span>
                                        <span class="text-xs bg-amber-600 px-2 py-1 rounded">Lv <span id="manualLevel">1</span></span>
                                    </div>
                                    <button id="upgradeManual" class="w-full px-3 py-1 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                                        Upgrade - <span id="manualCost">20</span> Solari
                                    </button>
                                </div>
                            </div>

                            <!-- Auto Harvesters -->
                            <div class="mb-4">
                                <h4 class="font-semibold mb-2">Automation</h4>
                                <div class="space-y-2">
                                    <div class="bg-stone-700 rounded p-3">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm">ü§ñ Auto-Harvesters</span>
                                            <span class="text-xs bg-blue-600 px-2 py-1 rounded"><span id="autoHarvesterCount">0</span> units</span>
                                        </div>
                                        <div class="text-xs text-stone-400 mb-2">+<span id="autoProduction">0</span> spice/sec</div>
                                        <button id="buyAutoHarvester" class="w-full px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm">
                                            Buy - <span id="autoHarvesterCost">100</span> Solari
                                        </button>
                                    </div>
                                    
                                    <div class="bg-stone-700 rounded p-3">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm">üíß Water Collectors</span>
                                            <span class="text-xs bg-blue-600 px-2 py-1 rounded"><span id="waterCollectorCount">0</span> units</span>
                                        </div>
                                        <div class="text-xs text-stone-400 mb-2">+<span id="waterProduction">0</span> water/sec</div>
                                        <button id="buyWaterCollector" class="w-full px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm">
                                            Buy - <span id="waterCollectorCost">150</span> Solari
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Buildings -->
                            <div class="mb-4">
                                <h4 class="font-semibold mb-2">Buildings</h4>
                                <div class="space-y-2">
                                    <div class="bg-stone-700 rounded p-3">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="text-sm">üè≠ Spice Refinery</span>
                                            <span class="text-xs bg-purple-600 px-2 py-1 rounded">Lv <span id="refineryLevel">0</span></span>
                                        </div>
                                        <div class="text-xs text-stone-400 mb-2">Converts spice to solari</div>
                                        <button id="buildRefinery" class="w-full px-3 py-1 bg-purple-600 hover:bg-purple-700 rounded text-sm">
                                            Build - 500 Solari, 50 Plasteel
                                        </button>
                                    </div>
                                    
                                    <div class="bg-stone-700 rounded p-3">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="text-sm">üõ°Ô∏è Defense Tower</span>
                                            <span class="text-xs bg-red-600 px-2 py-1 rounded">Lv <span id="defenseLevel">0</span></span>
                                        </div>
                                        <div class="text-xs text-stone-400 mb-2">Protects from raids</div>
                                        <button id="buildDefense" class="w-full px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm">
                                            Build - 400 Solari, 40 Plasteel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Section - Quests & Units -->
                    <div class="grid grid-cols-2 gap-4 p-4 pt-0">
                        <!-- Active Quests -->
                        <div class="bg-stone-800 rounded-lg p-4 max-h-64 overflow-y-auto">
                            <h3 class="text-lg font-semibold text-amber-400 mb-3">üìã Active Quests</h3>
                            <div id="questList" class="space-y-2"></div>
                        </div>

                        <!-- Units -->
                        <div class="bg-stone-800 rounded-lg p-4 max-h-64 overflow-y-auto">
                            <h3 class="text-lg font-semibold text-amber-400 mb-3">‚öîÔ∏è Military Units</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="bg-stone-700 rounded p-2">
                                    <div class="text-center">
                                        <div class="text-2xl">üó°Ô∏è</div>
                                        <div class="text-xs font-semibold">Infantry</div>
                                        <div class="text-xs text-stone-400"><span id="infantryCount">0</span> units</div>
                                        <button id="recruitInfantry" class="mt-1 w-full px-2 py-1 bg-red-600 hover:bg-red-700 rounded text-xs">
                                            100 Solari
                                        </button>
                                    </div>
                                </div>
                                <div class="bg-stone-700 rounded p-2">
                                    <div class="text-center">
                                        <div class="text-2xl">üèπ</div>
                                        <div class="text-xs font-semibold">Archers</div>
                                        <div class="text-xs text-stone-400"><span id="archerCount">0</span> units</div>
                                        <button id="recruitArcher" class="mt-1 w-full px-2 py-1 bg-red-600 hover:bg-red-700 rounded text-xs">
                                            150 Solari
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar - Players & Chat -->
                <div class="w-80 bg-stone-800 border-l border-stone-700 flex flex-col">
                    <!-- Online Players -->
                    <div class="p-4 border-b border-stone-700">
                        <h3 class="text-lg font-semibold text-amber-400 mb-3">üë• Online Players</h3>
                        <div id="playerList" class="space-y-2 max-h-48 overflow-y-auto"></div>
                    </div>

                    <!-- Leaderboard -->
                    <div class="p-4 border-b border-stone-700">
                        <h3 class="text-lg font-semibold text-amber-400 mb-3">üèÜ Top Players</h3>
                        <div id="leaderboard" class="space-y-2 text-sm"></div>
                    </div>

                    <!-- Chat -->
                    <div class="flex-1 flex flex-col p-4">
                        <h3 class="text-lg font-semibold text-amber-400 mb-3">üí¨ Global Chat</h3>
                        <div id="chatMessages" class="flex-1 bg-stone-900 rounded p-2 text-xs overflow-y-auto mb-2"></div>
                        <div class="flex">
                            <input id="chatInput" type="text" placeholder="Type message..." class="flex-1 px-2 py-1 bg-stone-700 rounded-l text-sm" maxlength="100">
                            <button id="chatSend" class="px-3 py-1 bg-amber-600 hover:bg-amber-700 rounded-r text-sm">Send</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Character Tab -->
            <div id="characterTab" class="tab-content hidden flex-1 p-6">
                <div class="grid grid-cols-2 gap-6 max-w-6xl mx-auto">
                    <!-- Character Info -->
                    <div>
                        <h2 class="text-2xl font-bold text-amber-400 mb-6">üë§ Character</h2>
                        
                        <div class="bg-stone-800 rounded-lg p-6 mb-6">
                            <h3 class="text-xl font-semibold mb-4">Basic Information</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Name</label>
                                    <input id="playerName" type="text" class="w-full px-3 py-2 bg-stone-700 rounded" value="Survivor">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <span class="block text-sm font-medium mb-1">Level</span>
                                        <span id="playerLevel" class="text-2xl font-bold text-amber-400">1</span>
                                    </div>
                                    <div>
                                        <span class="block text-sm font-medium mb-1">Experience</span>
                                        <div class="progress-bar-bg rounded-full h-2 mt-2">
                                            <div id="expBar" class="progress-bar-fill h-full rounded-full" style="width: 0%"></div>
                                        </div>
                                        <span id="expText" class="text-xs text-stone-400">0 / 100</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-stone-800 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">Stats</h3>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span>‚öîÔ∏è Attack:</span>
                                    <span id="playerAttack" class="font-semibold text-red-400">10</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>üõ°Ô∏è Defense:</span>
                                    <span id="playerDefense" class="font-semibold text-blue-400">5</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>‚ú® Total Spice Collected:</span>
                                    <span id="totalSpiceCollected" class="font-semibold text-amber-400">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>üó∫Ô∏è Areas Explored:</span>
                                    <span id="areasExplored" class="font-semibold text-green-400">1</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Inventory -->
                    <div>
                        <h2 class="text-2xl font-bold text-amber-400 mb-6">üéí Inventory</h2>
                        
                        <div class="bg-stone-800 rounded-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-semibold">Equipment</h3>
                            </div>
                            <div class="grid grid-cols-3 gap-4 mb-6">
                                <div class="text-center">
                                    <div class="inventory-slot mx-auto mb-2" id="weaponSlot">
                                        <span class="text-2xl">‚öîÔ∏è</span>
                                    </div>
                                    <div class="text-sm">Weapon</div>
                                </div>
                                <div class="text-center">
                                    <div class="inventory-slot mx-auto mb-2" id="armorSlot">
                                        <span class="text-2xl">üõ°Ô∏è</span>
                                    </div>
                                    <div class="text-sm">Armor</div>
                                </div>
                                <div class="text-center">
                                    <div class="inventory-slot mx-auto mb-2" id="accessorySlot">
                                        <span class="text-2xl">üíç</span>
                                    </div>
                                    <div class="text-sm">Accessory</div>
                                </div>
                            </div>

                            <h4 class="font-semibold mb-3">Items</h4>
                            <div id="inventoryGrid" class="grid grid-cols-8 gap-2">
                                <!-- Inventory slots will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Multiplayer Tab -->
            <div id="multiplayerTab" class="tab-content hidden flex-1 p-6">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-2xl font-bold text-amber-400 mb-6">üë• Multiplayer</h2>
                    
                    <div class="grid grid-cols-2 gap-6">
                        <!-- Full Leaderboard -->
                        <div class="bg-stone-800 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">üèÜ Global Rankings</h3>
                            <div id="fullLeaderboard" class="space-y-3 max-h-96 overflow-y-auto"></div>
                        </div>

                        <!-- Server Events -->
                        <div class="bg-stone-800 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">üéâ Server Events</h3>
                            <div class="space-y-4">
                                <div class="border border-amber-600 rounded-lg p-4 bg-amber-900/20">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="font-semibold text-amber-400">Great Spice Storm</h4>
                                        <span class="text-xs bg-amber-600 px-2 py-1 rounded">ACTIVE</span>
                                    </div>
                                    <p class="text-sm text-stone-400 mb-2">Double spice drops from all sources!</p>
                                    <div class="text-xs text-amber-400">Ends in: 2h 34m</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lore Tab -->
            <div id="loreTab" class="tab-content hidden flex-1 p-6 overflow-y-auto">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold text-amber-400 mb-6">üìö Lore & Knowledge</h2>
                    
                    <div class="space-y-6">
                        <div class="bg-stone-800 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">üèúÔ∏è Welcome to Arrakis</h3>
                            <p class="text-stone-300 leading-relaxed">
                                You've arrived on Arrakis, the desert planet that is the sole source of the universe's most valuable substance: the spice melange. 
                                As a survivor struggling to establish yourself in this harsh environment, you must harvest spice, build your settlement, and rise through the ranks 
                                to become a powerful force on this unforgiving world.
                            </p>
                        </div>

                        <div class="bg-stone-800 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">‚ú® The Spice</h3>
                            <p class="text-stone-300 leading-relaxed">
                                Melange, known simply as "the spice," is found only in the deep deserts of Arrakis. It extends life, enhances mental abilities, 
                                and makes interstellar travel possible. Control of the spice means control of the universe itself. But beware - the desert is full of dangers, 
                                from sandstorms to the mighty sandworms that create the spice.
                            </p>
                        </div>

                        <div class="bg-stone-800 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">üìà Rise to Power</h3>
                            <p class="text-stone-300 leading-relaxed">
                                Start as a humble survivor and work your way up through the ranks. Harvest spice manually at first, then invest in automation and buildings. 
                                Explore the dangerous desert to find resource deposits and ancient technology. Form alliances with other players or compete for dominance. 
                                The path you choose will determine your fate on Arrakis.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Combat Modal -->
    <div id="combatModal" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center z-50">
        <div class="bg-stone-800 rounded-lg p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-red-400 mb-4">‚öîÔ∏è Combat</h3>
            
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span id="enemyName" class="font-semibold">Sand Raider</span>
                    <span id="enemyHealth" class="text-sm">50 / 50</span>
                </div>
                <div class="progress-bar-bg rounded-full h-2">
                    <div id="enemyHealthBar" class="bg-red-500 h-full rounded-full" style="width: 100%"></div>
                </div>
            </div>

            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-semibold">You</span>
                    <span id="combatPlayerHealth" class="text-sm">200 / 200</span>
                </div>
                <div class="progress-bar-bg rounded-full h-2">
                    <div id="playerHealthBar" class="progress-bar-fill h-full rounded-full" style="width: 100%"></div>
                </div>
            </div>

            <div id="combatLog" class="bg-stone-900 rounded p-3 h-32 overflow-y-auto text-sm mb-4"></div>

            <div class="flex space-x-2">
                <button id="attackBtn" class="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 rounded">Attack</button>
                <button id="fleeBtn" class="px-4 py-2 bg-stone-600 hover:bg-stone-700 rounded">Flee</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <script>
        // Game State
        const gameState = {
            // Resources
            resources: {
                spice: 0,
                water: 842,
                solari: 224,
                plasteel: 146,
                food: 20
            },
            
            // Player
            player: {
                name: 'Survivor',
                level: 1,
                experience: 0,
                experienceToNext: 100,
                health: 200,
                maxHealth: 200,
                attack: 10,
                defense: 5,
                position: { x: 25, y: 25 },
                totalSpiceCollected: 0
            },
            
            // Production
            production: {
                manual: {
                    level: 1,
                    cost: 20
                },
                autoHarvesters: {
                    count: 0,
                    production: 2,
                    cost: 100
                },
                waterCollectors: {
                    count: 0,
                    production: 1,
                    cost: 150
                }
            },
            
            // Buildings
            buildings: {
                refinery: { level: 0, production: 5 },
                defense: { level: 0, protection: 50 }
            },
            
            // Units
            units: {
                infantry: { count: 0, attack: 15, cost: 100 },
                archer: { count: 0, attack: 20, cost: 150 }
            },
            
            // Map
            map: {
                size: 50,
                viewSize: 15,
                explored: new Set(['25,25']),
                locations: new Map(),
                currentView: { x: 25, y: 25 }
            },
            
            // Quests
            quests: [
                {
                    id: 1,
                    title: "First Steps",
                    description: "Harvest 50 spice",
                    target: 50,
                    progress: 0,
                    completed: false,
                    reward: { solari: 100, experience: 50 }
                },
                {
                    id: 2,
                    title: "Explorer",
                    description: "Explore 10 map tiles",
                    target: 10,
                    progress: 1,
                    completed: false,
                    reward: { plasteel: 20, experience: 30 }
                }
            ],
            
            // Inventory
            inventory: new Array(40).fill(null),
            equipment: {
                weapon: null,
                armor: null,
                accessory: null
            },
            
            // Other players (mock data)
            otherPlayers: [
                { name: "SpiceLord", position: { x: 30, y: 20 }, spice: 1523 },
                { name: "DesertWalker", position: { x: 15, y: 35 }, spice: 892 },
                { name: "FremenScout", position: { x: 40, y: 40 }, spice: 456 }
            ]
        };

        // Initialize map locations
        function initializeMap() {
            gameState.map.locations.set('25,25', { type: 'home', name: 'Your Settlement' });
            gameState.map.locations.set('30,25', { type: 'spice', amount: 50 });
            gameState.map.locations.set('20,20', { type: 'enemy', enemy: { name: 'Sand Raider', health: 50, attack: 8 } });
            gameState.map.locations.set('35,30', { type: 'water', amount: 30 });
            gameState.map.locations.set('15,35', { type: 'ruins', loot: { plasteel: 10, solari: 50 } });
        }

        // Render map
        function renderMap() {
            const container = document.getElementById('mapContainer');
            container.innerHTML = '';
            
            const playerPos = gameState.player.position;
            const viewRadius = Math.floor(gameState.map.viewSize / 2);
            
            for (let y = -viewRadius; y <= viewRadius; y++) {
                for (let x = -viewRadius; x <= viewRadius; x++) {
                    const worldX = playerPos.x + x;
                    const worldY = playerPos.y + y;
                    const key = `${worldX},${worldY}`;
                    
                    const cell = document.createElement('div');
                    cell.className = 'map-cell';
                    cell.style.width = '30px';
                    cell.style.height = '30px';
                    
                    // Check if explored
                    if (gameState.map.explored.has(key)) {
                        cell.classList.add('bg-amber-800', 'hover:bg-amber-700');
                        
                        // Check for special locations
                        const location = gameState.map.locations.get(key);
                        if (location) {
                            switch (location.type) {
                                case 'home':
                                    cell.innerHTML = 'üè†';
                                    cell.classList.add('bg-green-700');
                                    break;
                                case 'spice':
                                    cell.innerHTML = '‚ú®';
                                    cell.classList.add('bg-orange-600');
                                    break;
                                case 'enemy':
                                    cell.innerHTML = 'üíÄ';
                                    cell.classList.add('bg-red-600');
                                    break;
                                case 'water':
                                    cell.innerHTML = 'üíß';
                                    cell.classList.add('bg-blue-600');
                                    break;
                                case 'ruins':
                                    cell.innerHTML = 'üèõÔ∏è';
                                    cell.classList.add('bg-purple-600');
                                    break;
                            }
                        }
                        
                        // Player position
                        if (worldX === playerPos.x && worldY === playerPos.y) {
                            cell.innerHTML = 'ü§†';
                            cell.classList.add('bg-yellow-500', 'player-indicator');
                        }
                        
                        // Other players
                        gameState.otherPlayers.forEach(player => {
                            if (player.position.x === worldX && player.position.y === worldY) {
                                cell.innerHTML = 'üë§';
                                cell.classList.add('bg-blue-500');
                                cell.title = player.name;
                            }
                        });
                    } else {
                        cell.classList.add('bg-stone-900');
                        cell.innerHTML = '?';
                    }
                    
                    // Click to move
                    cell.addEventListener('click', () => {
                        if (Math.abs(worldX - playerPos.x) <= 1 && Math.abs(worldY - playerPos.y) <= 1) {
                            movePlayer(worldX, worldY);
                        }
                    });
                    
                    container.appendChild(cell);
                }
            }
            
            renderMinimap();
        }

        // Render minimap
        function renderMinimap() {
            const container = document.getElementById('minimapContainer');
            container.innerHTML = '';
            
            const scale = 3;
            gameState.map.explored.forEach(key => {
                const [x, y] = key.split(',').map(Number);
                const cell = document.createElement('div');
                cell.className = 'minimap-cell bg-amber-700';
                cell.style.left = `${x * scale}px`;
                cell.style.top = `${y * scale}px`;
                container.appendChild(cell);
            });
            
            // Player position
            const playerCell = document.createElement('div');
            playerCell.className = 'minimap-cell bg-yellow-500';
            playerCell.style.left = `${gameState.player.position.x * scale}px`;
            playerCell.style.top = `${gameState.player.position.y * scale}px`;
            playerCell.style.zIndex = '10';
            container.appendChild(playerCell);
        }

        // Move player
        function movePlayer(x, y) {
            const waterCost = 1;
            if (gameState.resources.water < waterCost) {
                showNotification('Not enough water to move!', 'error');
                return;
            }
            
            gameState.resources.water -= waterCost;
            gameState.player.position = { x, y };
            
            const key = `${x},${y}`;
            gameState.map.explored.add(key);
            
            // Update quest progress
            const explorerQuest = gameState.quests.find(q => q.id === 2);
            if (explorerQuest && !explorerQuest.completed) {
                explorerQuest.progress = gameState.map.explored.size;
                if (explorerQuest.progress >= explorerQuest.target) {
                    completeQuest(explorerQuest);
                }
            }
            
            // Check location
            const location = gameState.map.locations.get(key);
            if (location) {
                handleLocationEncounter(location, key);
            }
            
            updateUI();
            renderMap();
            log(`Moved to (${x}, ${y})`);
        }

        // Handle location encounters
        function handleLocationEncounter(location, key) {
            switch (location.type) {
                case 'spice':
                    if (location.amount > 0) {
                        const harvest = Math.min(location.amount, 10);
                        gameState.resources.spice += harvest;
                        gameState.player.totalSpiceCollected += harvest;
                        location.amount -= harvest;
                        log(`Found spice deposit! +${harvest} spice`, 'success');
                        
                        if (location.amount <= 0) {
                            gameState.map.locations.delete(key);
                        }
                    }
                    break;
                    
                case 'enemy':
                    if (location.enemy) {
                        startCombat(location.enemy);
                    }
                    break;
                    
                case 'water':
                    if (location.amount > 0) {
                        const collect = Math.min(location.amount, 10);
                        gameState.resources.water += collect;
                        location.amount -= collect;
                        log(`Found water! +${collect} water`, 'success');
                        
                        if (location.amount <= 0) {
                            gameState.map.locations.delete(key);
                        }
                    }
                    break;
                    
                case 'ruins':
                    if (location.loot) {
                        Object.entries(location.loot).forEach(([resource, amount]) => {
                            gameState.resources[resource] += amount;
                            log(`Found ${amount} ${resource} in the ruins!`, 'success');
                        });
                        gameState.map.locations.delete(key);
                    }
                    break;
            }
        }

        // Combat system
        let currentEnemy = null;
        
        function startCombat(enemy) {
            currentEnemy = { ...enemy };
            document.getElementById('combatModal').classList.remove('hidden');
            document.getElementById('combatModal').classList.add('flex');
            document.getElementById('enemyName').textContent = enemy.name;
            document.getElementById('enemyHealth').textContent = `${enemy.health} / ${enemy.health}`;
            document.getElementById('combatLog').innerHTML = `<p>Encountered ${enemy.name}!</p>`;
            updateCombatUI();
        }
        
        function updateCombatUI() {
            if (!currentEnemy) return;
            
            const enemyHealthPercent = (currentEnemy.health / 50) * 100;
            const playerHealthPercent = (gameState.player.health / gameState.player.maxHealth) * 100;
            
            document.getElementById('enemyHealthBar').style.width = `${enemyHealthPercent}%`;
            document.getElementById('playerHealthBar').style.width = `${playerHealthPercent}%`;
            document.getElementById('combatPlayerHealth').textContent = `${gameState.player.health} / ${gameState.player.maxHealth}`;
        }
        
        function combatAttack() {
            if (!currentEnemy) return;
            
            const combatLog = document.getElementById('combatLog');
            
            // Player attacks
            const playerDamage = gameState.player.attack + Math.floor(Math.random() * 5);
            currentEnemy.health -= playerDamage;
            combatLog.innerHTML += `<p class="text-green-400">You deal ${playerDamage} damage!</p>`;
            
            if (currentEnemy.health <= 0) {
                // Victory
                const reward = Math.floor(Math.random() * 50) + 25;
                gameState.resources.solari += reward;
                gameState.player.experience += 20;
                combatLog.innerHTML += `<p class="text-amber-400">Victory! +${reward} solari, +20 exp</p>`;
                
                // Remove enemy from map
                const enemyKey = `${gameState.player.position.x},${gameState.player.position.y}`;
                gameState.map.locations.delete(enemyKey);
                
                setTimeout(() => {
                    document.getElementById('combatModal').classList.add('hidden');
                    checkLevelUp();
                    updateUI();
                    renderMap();
                }, 2000);
                return;
            }
            
            // Enemy attacks
            const enemyDamage = currentEnemy.attack + Math.floor(Math.random() * 3);
            gameState.player.health -= enemyDamage;
            combatLog.innerHTML += `<p class="text-red-400">${currentEnemy.name} deals ${enemyDamage} damage!</p>`;
            
            if (gameState.player.health <= 0) {
                // Defeat
                gameState.player.health = 50; // Respawn with partial health
                gameState.player.position = { x: 25, y: 25 }; // Return to base
                combatLog.innerHTML += `<p class="text-red-600">Defeated! Returned to base...</p>`;
                
                setTimeout(() => {
                    document.getElementById('combatModal').classList.add('hidden');
                    updateUI();
                    renderMap();
                }, 2000);
                return;
            }
            
            updateCombatUI();
            combatLog.scrollTop = combatLog.scrollHeight;
        }
        
        function combatFlee() {
            const fleeChance = Math.random();
            const combatLog = document.getElementById('combatLog');
            
            if (fleeChance > 0.5) {
                combatLog.innerHTML += `<p class="text-yellow-400">Fled successfully!</p>`;
                gameState.player.position = { x: 25, y: 25 };
                
                setTimeout(() => {
                    document.getElementById('combatModal').classList.add('hidden');
                    updateUI();
                    renderMap();
                }, 1000);
            } else {
                combatLog.innerHTML += `<p class="text-red-400">Failed to flee!</p>`;
                combatAttack(); // Enemy gets free attack
            }
        }

        // Harvest spice
        function harvestSpice() {
            const amount = gameState.production.manual.level;
            gameState.resources.spice += amount;
            gameState.player.totalSpiceCollected += amount;
            
            // Update quest progress
            const spiceQuest = gameState.quests.find(q => q.id === 1);
            if (spiceQuest && !spiceQuest.completed) {
                spiceQuest.progress = gameState.player.totalSpiceCollected;
                if (spiceQuest.progress >= spiceQuest.target) {
                    completeQuest(spiceQuest);
                }
            }
            
            updateUI();
            log(`Harvested ${amount} spice`);
        }

        // Complete quest
        function completeQuest(quest) {
            quest.completed = true;
            
            // Give rewards
            Object.entries(quest.reward).forEach(([reward, amount]) => {
                if (reward === 'experience') {
                    gameState.player.experience += amount;
                } else {
                    gameState.resources[reward] += amount;
                }
            });
            
            log(`Quest completed: ${quest.title}!`, 'success');
            showNotification(`Quest completed: ${quest.title}!`, 'success');
            checkLevelUp();
            updateUI();
        }

        // Check level up
        function checkLevelUp() {
            while (gameState.player.experience >= gameState.player.experienceToNext) {
                gameState.player.level++;
                gameState.player.experience -= gameState.player.experienceToNext;
                gameState.player.experienceToNext = Math.floor(gameState.player.experienceToNext * 1.5);
                
                // Increase stats
                gameState.player.maxHealth += 20;
                gameState.player.health = gameState.player.maxHealth;
                gameState.player.attack += 2;
                gameState.player.defense += 1;
                
                showNotification(`Level up! You are now level ${gameState.player.level}`, 'success');
            }
        }

        // Upgrade functions
        function upgradeManualHarvesting() {
            const cost = gameState.production.manual.cost;
            if (gameState.resources.solari >= cost) {
                gameState.resources.solari -= cost;
                gameState.production.manual.level++;
                gameState.production.manual.cost = Math.floor(cost * 1.5);
                updateUI();
                log('Manual harvesting upgraded!', 'success');
            } else {
                showNotification('Not enough Solari!', 'error');
            }
        }

        function buyAutoHarvester() {
            const cost = gameState.production.autoHarvesters.cost;
            if (gameState.resources.solari >= cost) {
                gameState.resources.solari -= cost;
                gameState.production.autoHarvesters.count++;
                gameState.production.autoHarvesters.cost = Math.floor(cost * 1.25);
                updateUI();
                log('Auto-harvester purchased!', 'success');
            } else {
                showNotification('Not enough Solari!', 'error');
            }
        }

        function buyWaterCollector() {
            const cost = gameState.production.waterCollectors.cost;
            if (gameState.resources.solari >= cost) {
                gameState.resources.solari -= cost;
                gameState.production.waterCollectors.count++;
                gameState.production.waterCollectors.cost = Math.floor(cost * 1.25);
                updateUI();
                log('Water collector purchased!', 'success');
            } else {
                showNotification('Not enough Solari!', 'error');
            }
        }

        // Building functions
        function buildRefinery() {
            if (gameState.resources.solari >= 500 && gameState.resources.plasteel >= 50) {
                gameState.resources.solari -= 500;
                gameState.resources.plasteel -= 50;
                gameState.buildings.refinery.level++;
                updateUI();
                log('Spice refinery built!', 'success');
            } else {
                showNotification('Not enough resources!', 'error');
            }
        }

        function buildDefense() {
            if (gameState.resources.solari >= 400 && gameState.resources.plasteel >= 40) {
                gameState.resources.solari -= 400;
                gameState.resources.plasteel -= 40;
                gameState.buildings.defense.level++;
                updateUI();
                log('Defense tower built!', 'success');
            } else {
                showNotification('Not enough resources!', 'error');
            }
        }

        // Unit recruitment
        function recruitInfantry() {
            if (gameState.resources.solari >= gameState.units.infantry.cost) {
                gameState.resources.solari -= gameState.units.infantry.cost;
                gameState.units.infantry.count++;
                updateUI();
                log('Infantry recruited!', 'success');
            } else {
                showNotification('Not enough Solari!', 'error');
            }
        }

        function recruitArcher() {
            if (gameState.resources.solari >= gameState.units.archer.cost) {
                gameState.resources.solari -= gameState.units.archer.cost;
                gameState.units.archer.count++;
                updateUI();
                log('Archer recruited!', 'success');
            } else {
                showNotification('Not enough Solari!', 'error');
            }
        }

        // Auto production
        function autoProduction() {
            // Auto harvesters
            if (gameState.production.autoHarvesters.count > 0) {
                const spiceProduction = gameState.production.autoHarvesters.count * gameState.production.autoHarvesters.production;
                gameState.resources.spice += spiceProduction;
                gameState.player.totalSpiceCollected += spiceProduction;
            }
            
            // Water collectors
            if (gameState.production.waterCollectors.count > 0) {
                const waterProduction = gameState.production.waterCollectors.count * gameState.production.waterCollectors.production;
                gameState.resources.water += waterProduction;
            }
            
            // Refinery
            if (gameState.buildings.refinery.level > 0) {
                const solariProduction = gameState.buildings.refinery.level * gameState.buildings.refinery.production;
                if (gameState.resources.spice >= solariProduction) {
                    gameState.resources.spice -= solariProduction;
                    gameState.resources.solari += solariProduction * 2;
                }
            }
            
            // Health regeneration
            if (gameState.player.health < gameState.player.maxHealth) {
                gameState.player.health = Math.min(gameState.player.health + 1, gameState.player.maxHealth);
            }
            
            updateUI();
        }

        // Update UI
        function updateUI() {
            // Resources
            document.getElementById('spiceCount').textContent = gameState.resources.spice;
            document.getElementById('waterCount').textContent = gameState.resources.water;
            document.getElementById('solariCount').textContent = gameState.resources.solari;
            document.getElementById('plasteelCount').textContent = gameState.resources.plasteel;
            document.getElementById('foodCount').textContent = gameState.resources.food;
            
            // Health
            const healthPercent = (gameState.player.health / gameState.player.maxHealth) * 100;
            document.getElementById('healthBar').style.width = `${healthPercent}%`;
            document.getElementById('healthText').textContent = `${gameState.player.health} / ${gameState.player.maxHealth}`;
            
            // Manual harvesting
            document.getElementById('harvestLevel').textContent = gameState.production.manual.level;
            document.getElementById('harvestAmount').textContent = gameState.production.manual.level;
            document.getElementById('manualLevel').textContent = gameState.production.manual.level;
            document.getElementById('manualCost').textContent = gameState.production.manual.cost;
            
            // Auto production
            document.getElementById('autoHarvesterCount').textContent = gameState.production.autoHarvesters.count;
            document.getElementById('autoProduction').textContent = gameState.production.autoHarvesters.count * gameState.production.autoHarvesters.production;
            document.getElementById('autoHarvesterCost').textContent = gameState.production.autoHarvesters.cost;
            
            document.getElementById('waterCollectorCount').textContent = gameState.production.waterCollectors.count;
            document.getElementById('waterProduction').textContent = gameState.production.waterCollectors.count * gameState.production.waterCollectors.production;
            document.getElementById('waterCollectorCost').textContent = gameState.production.waterCollectors.cost;
            
            // Buildings
            document.getElementById('refineryLevel').textContent = gameState.buildings.refinery.level;
            document.getElementById('defenseLevel').textContent = gameState.buildings.defense.level;
            
            // Units
            document.getElementById('infantryCount').textContent = gameState.units.infantry.count;
            document.getElementById('archerCount').textContent = gameState.units.archer.count;
            
            // Player info
            document.getElementById('playerPosition').textContent = `(${gameState.player.position.x}, ${gameState.player.position.y})`;
            document.getElementById('playerLevel').textContent = gameState.player.level;
            document.getElementById('playerAttack').textContent = gameState.player.attack;
            document.getElementById('playerDefense').textContent = gameState.player.defense;
            document.getElementById('totalSpiceCollected').textContent = gameState.player.totalSpiceCollected;
            document.getElementById('areasExplored').textContent = gameState.map.explored.size;
            
            // Experience bar
            const expPercent = (gameState.player.experience / gameState.player.experienceToNext) * 100;
            document.getElementById('expBar').style.width = `${expPercent}%`;
            document.getElementById('expText').textContent = `${gameState.player.experience} / ${gameState.player.experienceToNext}`;
            
            // Update rank
            updateRank();
            
            // Update quests
            updateQuests();
            
            // Update players list
            updatePlayersList();
            
            // Update leaderboard
            updateLeaderboard();
        }

        // Update rank based on spice collected
        function updateRank() {
            const spice = gameState.player.totalSpiceCollected;
            let rank = 'Novice';
            let rankClass = 'bg-stone-700';
            
            if (spice >= 10000) {
                rank = 'Spice Baron';
                rankClass = 'bg-amber-500 text-black';
            } else if (spice >= 5000) {
                rank = 'Master Trader';
                rankClass = 'bg-purple-600';
            } else if (spice >= 2000) {
                rank = 'Expert';
                rankClass = 'bg-blue-600';
            } else if (spice >= 500) {
                rank = 'Adept';
                rankClass = 'bg-green-600';
            } else if (spice >= 100) {
                rank = 'Apprentice';
                rankClass = 'bg-stone-600';
            }
            
            const rankElement = document.getElementById('playerRank');
            rankElement.textContent = rank;
            rankElement.className = `px-2 py-1 rounded text-xs font-semibold ${rankClass}`;
        }

        // Update quests display
        function updateQuests() {
            const container = document.getElementById('questList');
            container.innerHTML = '';
            
            gameState.quests.filter(q => !q.completed).forEach(quest => {
                const questDiv = document.createElement('div');
                questDiv.className = 'bg-stone-700 rounded p-3';
                questDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="font-semibold text-sm">${quest.title}</span>
                        <span class="text-xs text-amber-400">${quest.progress}/${quest.target}</span>
                    </div>
                    <p class="text-xs text-stone-400 mb-2">${quest.description}</p>
                    <div class="progress-bar-bg rounded-full h-1">
                        <div class="progress-bar-fill h-full rounded-full" style="width: ${(quest.progress / quest.target) * 100}%"></div>
                    </div>
                `;
                container.appendChild(questDiv);
            });
        }

        // Update players list
        function updatePlayersList() {
            const container = document.getElementById('playerList');
            container.innerHTML = '';
            
            // Add current player
            const youDiv = document.createElement('div');
            youDiv.className = 'flex items-center justify-between p-2 bg-amber-900/30 rounded';
            youDiv.innerHTML = `
                <span class="text-sm font-semibold">${gameState.player.name} (You)</span>
                <span class="text-xs text-amber-400">${gameState.player.totalSpiceCollected} spice</span>
            `;
            container.appendChild(youDiv);
            
            // Add other players
            gameState.otherPlayers.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'flex items-center justify-between p-2 hover:bg-stone-700 rounded';
                playerDiv.innerHTML = `
                    <span class="text-sm">${player.name}</span>
                    <span class="text-xs text-stone-400">${player.spice} spice</span>
                `;
                container.appendChild(playerDiv);
            });
        }

        // Update leaderboard
        function updateLeaderboard() {
            const container = document.getElementById('leaderboard');
            container.innerHTML = '';
            
            // Combine all players and sort by spice
            const allPlayers = [
                { name: gameState.player.name + ' (You)', spice: gameState.player.totalSpiceCollected },
                ...gameState.otherPlayers
            ];
            
            allPlayers.sort((a, b) => b.spice - a.spice);
            
            // Display top 3
            allPlayers.slice(0, 3).forEach((player, index) => {
                const rank = index + 1;
                const medal = rank === 1 ? 'üëë' : rank === 2 ? 'ü•à' : 'ü•â';
                
                const playerDiv = document.createElement('div');
                playerDiv.className = 'flex items-center justify-between p-2 rounded ' + (player.name.includes('(You)') ? 'bg-amber-900/30' : '');
                playerDiv.innerHTML = `
                    <span class="text-sm">${medal} ${player.name}</span>
                    <span class="text-xs text-amber-400">${player.spice} spice</span>
                `;
                container.appendChild(playerDiv);
            });
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    container.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Game log
        function log(message, type = 'info') {
            const logContainer = document.getElementById('gameLog');
            const logEntry = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const colorClass = {
                info: 'text-stone-300',
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            }[type] || 'text-stone-300';
            
            logEntry.className = `mb-1 ${colorClass}`;
            logEntry.innerHTML = `<span class="text-stone-500">[${timestamp}]</span> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Keep only last 50 messages
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        // Save game
        function saveGame() {
            const saveData = {
                gameState: gameState,
                timestamp: Date.now()
            };
            
            localStorage.setItem('arrakisTycoonSave', JSON.stringify(saveData));
            showNotification('Game saved!', 'success');
            log('Game saved', 'success');
        }

        // Load game
        function loadGame() {
            const saveData = localStorage.getItem('arrakisTycoonSave');
            if (saveData) {
                const data = JSON.parse(saveData);
                Object.assign(gameState, data.gameState);
                showNotification('Game loaded!', 'success');
                log('Game loaded', 'success');
                updateUI();
                renderMap();
                return true;
            }
            return false;
        }

        // Initialize game
        function initGame() {
            // Try to load saved game
            if (!loadGame()) {
                initializeMap();
            }
            
            // Event listeners
            document.getElementById('harvestSpiceBtn').addEventListener('click', harvestSpice);
            document.getElementById('upgradeManual').addEventListener('click', upgradeManualHarvesting);
            document.getElementById('buyAutoHarvester').addEventListener('click', buyAutoHarvester);
            document.getElementById('buyWaterCollector').addEventListener('click', buyWaterCollector);
            document.getElementById('buildRefinery').addEventListener('click', buildRefinery);
            document.getElementById('buildDefense').addEventListener('click', buildDefense);
            document.getElementById('recruitInfantry').addEventListener('click', recruitInfantry);
            document.getElementById('recruitArcher').addEventListener('click', recruitArcher);
            document.getElementById('saveBtn').addEventListener('click', saveGame);
            
            // Movement buttons
            document.querySelectorAll('.move-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const dir = e.target.dataset.dir;
                    const pos = gameState.player.position;
                    let newX = pos.x, newY = pos.y;
                    
                    switch(dir) {
                        case 'north': newY--; break;
                        case 'south': newY++; break;
                        case 'west': newX--; break;
                        case 'east': newX++; break;
                    }
                    
                    if (newX >= 0 && newX < gameState.map.size && newY >= 0 && newY < gameState.map.size) {
                        movePlayer(newX, newY);
                    }
                });
            });
            
            // Tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchTab(btn.dataset.tab);
                });
            });
            
            // Combat buttons
            document.getElementById('attackBtn').addEventListener('click', combatAttack);
            document.getElementById('fleeBtn').addEventListener('click', combatFlee);
            
            // Chat
            const chatInput = document.getElementById('chatInput');
            const chatSend = document.getElementById('chatSend');
            
            function sendChat() {
                const message = chatInput.value.trim();
                if (message) {
                    const chatMessages = document.getElementById('chatMessages');
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'mb-1';
                    messageDiv.innerHTML = `<span class="text-amber-400">${gameState.player.name}:</span> ${message}`;
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    chatInput.value = '';
                }
            }
            
            chatSend.addEventListener('click', sendChat);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChat();
            });
            
            // Player name change
            document.getElementById('playerName').addEventListener('change', (e) => {
                gameState.player.name = e.target.value || 'Survivor';
                updateUI();
            });
            
            // Initialize inventory
            const inventoryGrid = document.getElementById('inventoryGrid');
            for (let i = 0; i < 40; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                slot.dataset.slot = i;
                inventoryGrid.appendChild(slot);
            }
            
            // Start game loops
            renderMap();
            updateUI();
            
            // Auto production loop
            setInterval(autoProduction, 1000);
            
            // Auto save
            setInterval(saveGame, 60000); // Save every minute
            
            log('Welcome to Arrakis Tycoon!', 'info');
            log('The spice must flow...', 'warning');
        }

        // Start the game
        initGame();
    </script>
</body>
</html>
